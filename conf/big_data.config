/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    wf-paired-end-illumina-assembly Nextflow big data config file
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*/

process {
    cpus              = { check_max( 1    * task.attempt, 'cpus'     ) }
    memory            = { check_max( 6.GB * task.attempt, 'memory'   ) }

    errorStrategy     = { task.exitStatus in [143,137,104,134,139,71,255] ? 'retry' : 'ignore' }
    maxRetries        = 3
    maxErrors         = '-1'

    // Process-specific resource requirements
    withLabel:process_low {
        cpus          = { check_max( 2      * task.attempt, 'cpus'   ) }
        memory        = { check_max( 12.GB  * task.attempt, 'memory' ) }
    }
    // manual testing showed no speedup beyond 4CPUs for parsnp or pairwise distances on large input data sets
    withLabel:process_medium {
        cpus          = { check_max( 4      * task.attempt, 'cpus'   ) }
        memory        = { check_max( 72.GB  * task.attempt, 'memory' ) }
    }
    withLabel:process_high {
        cpus          = { check_max( 16     * task.attempt, 'cpus'   ) }
        memory        = { check_max( 72.GB  * task.attempt, 'memory' ) }
    }
    withLabel:process_high_memory {
        memory        = { check_max( 200.GB * task.attempt, 'memory' ) }
    }
    withLabel:error_ignore {
        errorStrategy = 'ignore'
    }
    withLabel:error_retry {
        errorStrategy = 'retry'
        maxRetries    = 3
    }
}
